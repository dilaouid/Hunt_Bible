<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Weapons Library</title>
    <link rel = "icon" href = "./assets/img/icon.png" type = "image/x-icon">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Amarante&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/weapons_library.css">
    <link rel="stylesheet" href="assets/css/Navbar-Centered-Brand-Dark.css">
    <link rel="stylesheet" href="assets/css/Vertical-scroll-box.css">
</head>

<body class="body">
    <nav class="navbar navbar-light navbar-expand-md py-3 navbar">
        <div class="container"><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-3"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse text-truncate nav-collapse" id="navcol-3">
                <ul class="navbar-nav" >
                    <li class="nav-item"><a class="nav-link active" href="index.html" style="color: #b4ae75;filter: brightness(109%);">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="damage_range.html" style="color: #b4ae75;filter: brightness(109%);">Damage &amp; Range</a></li>
                    <li class="nav-item"><a class="nav-link active" href="weapons_library.html" style="color: #b4ae75;filter: brightness(109%);">Weapons Library</a></li>
                    <li class="nav-item"><a class="nav-link active" href="traits.html" style="color: #b4ae75;filter: brightness(109%);">Traits</a></li>
                    <li class="nav-item"><a class="nav-link active" href="maps.html" style="color: #b4ae75;filter: brightness(109%);">Maps</a></li>
                    <li class="nav-item"><a class="nav-link isDisabled" href="#" style="color: #b4ae75;filter: brightness(109%);">Russian Roulette</a></li>
                </ul>
            </div>
        </div>
    </nav>
        <div class="container">
            <div class="row">
                <div class="col-auto libw offset-0 align-self-center" id="weapons">
                    <!-- Weapons List HERE -->
                </div>
                <div class="col-auto justify-content-center align-items-center" style="width: 334px;margin: 15px;">
                    <button class="btnW" id="large_weapons" onclick="changeImage('large_weapons')">Long Weapons</button>
                    <button class="btnW" id="medium_weapons" onclick="changeImage('medium_weapons')">Medium Weapons</button>
                    <button class="btnW" id="small_weapons" onclick="changeImage('small_weapons')">Small Weapons</button>
                    <input class="searchbar" type="text" placeholder="Search..." onkeyup="getResults()">
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-12 dBlock">
                <span id="label"></span>
                <br>
                <br>
                <span id="description"></span>
                <br>
                <div class="row g-0 ligne1">
                    <div class="col-2">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Damage</p>
                            </div>
                            <div class="col text-end">
                                <p class="value titreD" id="damage"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="damage_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2 offset-1">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Effective Range</p>
                            </div>
                            <div class="col text-end">
                                <p class="titreD" id="distance"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="distance_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-0 ligne2">
                    <div class="col-2">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Rate of Fire</p>
                            </div>
                            <div class="col text-end">
                                <p class="titreD" id="rof"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="rof_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2 offset-1">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Handling</p>
                            </div>
                            <div class="col text-end">
                                <p class="titreD" id="handling"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="handling_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-0 ligne3">
                    <div class="col-2">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Reload Speed</p>
                            </div>
                            <div class="col text-end">
                                <p class="titreD" id="reloadspeed"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="reloadspeed_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2 offset-1">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Muzzle Velocity</p>
                            </div>
                            <div class="col text-end">
                                <p class="titreD" id="muzzle"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="muzzle_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-0 ligne4">
                    <div class="col-2">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Melee Damage</p>
                            </div>
                            <div class="col text-end">
                                <p class="titreD" id="melee"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="melee_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2 offset-1">
                        <div class="row g-0">
                            <div class="col-auto text-start">
                                <p class="titreD">Heavy Melee Damage</p>
                            </div>
                            <div class="col text-end">
                                <p class="titreD" id="hmelee"></p>
                            </div>
                            <div class="col-12">
                                <div class="progressD">
                                    <div id="hmelee_progress_bar" class="progress-barD"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    <script src="assets/js/weapons.js" type="text/javascript"></script>
    <script>

        const maxValues = {
            damage: 150,
            rof: 100,
            handling: 100,
            reloadspeed: 20,
            muzzle: 800,
            melee: 150,
            hmelee: 150,
            distance: 250,
        };

        const progressbar = document.querySelector(".progress-barD");

        const changeProgress = (progress) => {
            progressbar.style.width = `${progress}%`;
        };
        
        const weaponsdiv = document.getElementById('weapons');
        var display = [];
        const weapon = ['large_weapons', 'medium_weapons', 'small_weapons'];

        // foreach => []
        // for..in => {}
        // for..of [] {}
        // while, for et co tmtc


        for (const size in weapons) { // tu parcours chaque propriete de ton objet
            weapons[size].forEach( (el, i) => {
                //console.log(el);
                var reload = false;
                let img = document.createElement('img');
                let parentDiv = document.createElement('div');
                // quand tu crée un element tu dois l'ajouter au dom avec appendelement

                parentDiv.classList.add('wcss', 'libw');
                img.setAttribute('type', el.type);
                img.setAttribute('label', el.label);
                img.setAttribute('description', el.description);
                img.setAttribute('damage', el.damage);
                img.setAttribute('distance', el.distance);
                img.setAttribute('rof', el.rof);
                img.setAttribute('handling', el.handling),
                img.setAttribute('reloadspeed', el.reloadspeed),
                img.setAttribute('muzzle', el.muzzle),
                img.setAttribute('melee', el.melee);
                img.setAttribute('hmelee', el.hmelee),
                img.id = el.value;
                img.src = `assets/img/weapons/${el.value}.png`;
                img.className = "weaponImg";
                weaponsdiv.appendChild(img)

                img.onclick = () => {
                    const attr = ["label", "description", "damage", "distance", "rof", 
                        "handling", "reloadspeed", "muzzle", "melee", "hmelee"];
                    attr.map( (at, i) => {
                        document.getElementById(at).innerHTML = el[at]
                        if (at != "label" && at != "description"){
                            const progress = document.getElementById(at+'_progress_bar');
                            progress.style.width = (parseInt(el[at]) + 90) + 'px'; // tu fais ton calcul de remplissage de la barre ici
                            // el[at] + x
                            // x étant la différence entre la maxvalue et la width de ta class progressD
                            /* console.log(attr);
                            console.log(100 * el[at] / maxValues[at]);
                            console.log(progress); */
                        }
                    });

                    

                    //document.getElementById('distance_progress_bar').setAttribute('aria-valuenow', el.distance)
                }
            })
        };

        function changeImage(weapon) {
            var reload = false;
            let all = document.getElementsByClassName('weaponImg');
            if (display.includes(weapon) === false)
                display.push(weapon);
            else {
                let idx = display.indexOf(weapon);
                display.splice(idx, 1)
            }
            if (display.length == 0)
                reload = true;

            // Changement couleur du bouton
            let btn = document.getElementById(weapon)
            btn.classList.contains("clickedButton") ? btn.classList.remove("clickedButton") : btn.classList.add("clickedButton")

            // parsing des armes
            Array.from(all).forEach( (el) => {
                const type = el.getAttribute('type')+'_weapons';
                if (reload == false && display.includes(type) === false && el.classList.contains('hidden') === false) {
                    el.classList.add('hidden');
                } else if (reload || (display.includes(type) && el.classList.contains('hidden'))) {
                    el.classList.remove('hidden');
                }
            });
        };

        function showDescription(value){
            document.getElementById('name').innerHTML=value;
        }

        function selectElement(selector){
            return document.querySelector(selector);
        }
        function clearResults(){
            selectElement('.search-results').innerHTML = "";
        }
        function getResults(){
            const search = selectElement('.searchbar').value.toLocaleLowerCase();
            let all = document.getElementsByClassName('weaponImg');
            let reload = false;

            search.substring()

            Array.from(all).forEach( (el,i) => {
                if (reload == false && el.getAttribute("label").toLocaleLowerCase().includes(search) === false && el.classList.contains('hidden-search') === false) {
                    el.classList.add('hidden-search');
                } else if (reload == true || el.getAttribute("label").toLocaleLowerCase().includes(search) === true && el.classList.contains('hidden-search') === true) {
                    el.classList.remove('hidden-search');
                }
            });
        };

        

    </script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>